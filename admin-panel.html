<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Admin Panel - AgriNova</title>
  <link href="assets/img/icon.png" rel="icon">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/css/admin-panel.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Toast - Inline backup */
    .toast-container { position: fixed !important; top: 20px !important; right: 20px !important; z-index: 9999 !important; display: flex !important; flex-direction: column !important; gap: 10px !important; }
    .toast { padding: 16px 24px !important; border-radius: 12px !important; color: white !important; display: flex !important; align-items: center !important; gap: 12px !important; box-shadow: 0 8px 30px rgba(0,0,0,0.3) !important; min-width: 320px !important; animation: toastIn 0.4s ease-out !important; }
    @keyframes toastIn { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
    .toast.success { background: linear-gradient(135deg, #28a745, #20c997) !important; }
    .toast.error { background: linear-gradient(135deg, #d32f2f, #f44336) !important; }
    .toast.info { background: linear-gradient(135deg, #1976d2, #42a5f5) !important; }
    .toast.warning { background: linear-gradient(135deg, #f57c00, #ffb74d) !important; }
    .toast i { font-size: 1.5rem !important; }
    .toast-content { flex: 1 !important; }
    .toast-content strong { display: block !important; font-weight: 600 !important; margin-bottom: 3px !important; }
    .toast-content span { opacity: 0.9 !important; font-size: 0.9rem !important; }
    .toast-close { background: none !important; border: none !important; color: white !important; cursor: pointer !important; font-size: 1.3rem !important; opacity: 0.8 !important; }
    .toast-close:hover { opacity: 1 !important; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <div class="logo"><i class="bi bi-leaf"></i></div>
      <h2>AgriNova</h2>
      <span>Admin Panel</span>
    </div>
    <nav class="sidebar-nav">
      <!-- Genel Bakış -->
      <a href="#" class="nav-item active" data-section="dashboard"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
      
      <!-- İletişim & Bildirimler (En sık kullanılan) -->
      <a href="#" class="nav-item" data-section="messages"><i class="bi bi-envelope-open"></i><span>Mesajlar</span></a>
      <a href="#" class="nav-item" data-section="applications"><i class="bi bi-person-plus"></i><span>Başvurular</span></a>
      <a href="#" class="nav-item" data-section="subscribers"><i class="bi bi-envelope-at"></i><span>Aboneler</span></a>
      <a href="#" class="nav-item" data-section="announcements"><i class="bi bi-megaphone"></i><span>Duyurular</span></a>
      
      <!-- İçerik Yönetimi -->
      <a href="#" class="nav-item" data-section="services"><i class="bi bi-gear"></i><span>Hizmetler</span></a>
      <a href="#" class="nav-item" data-section="portfolio"><i class="bi bi-collection"></i><span>Projeler</span></a>
      <a href="#" class="nav-item" data-section="team"><i class="bi bi-people"></i><span>Ekip</span></a>
      <a href="#" class="nav-item" data-section="testimonials"><i class="bi bi-chat-quote"></i><span>Yorumlar</span></a>
      
      <!-- Sayfa Ayarları (Daha az kullanılan) -->
      <a href="#" class="nav-item" data-section="hero"><i class="bi bi-house"></i><span>Hero Bölümü</span></a>
      <a href="#" class="nav-item" data-section="pricing"><i class="bi bi-currency-dollar"></i><span>Fiyatlandırma</span></a>
      <a href="#" class="nav-item" data-section="faq"><i class="bi bi-question-circle"></i><span>S.S.S.</span></a>
      <a href="#" class="nav-item" data-section="contact"><i class="bi bi-envelope"></i><span>İletişim</span></a>
      
      <!-- Sistem Yönetimi -->
      <a href="#" class="nav-item" data-section="users"><i class="bi bi-person-gear"></i><span>Kullanıcılar</span></a>
    </nav>
    <div class="sidebar-footer">
      <a href="index.html" target="_blank"><i class="bi bi-box-arrow-up-right"></i> Siteyi Görüntüle</a>
      <a href="#" onclick="logout()"><i class="bi bi-box-arrow-right"></i> Çıkış Yap</a>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <header class="top-header">
      <button class="menu-toggle" onclick="toggleSidebar()"><i class="bi bi-list"></i></button>
      <div class="header-right">
        <span class="welcome">Hoş geldin, <strong id="adminName">Admin</strong></span>
        <div class="user-avatar"><i class="bi bi-person-circle"></i></div>
      </div>
    </header>

    <div class="content-wrapper">
      <!-- Dashboard Section -->
      <section id="section-dashboard" class="content-section active">
        <h2><i class="bi bi-speedometer2"></i> Dashboard</h2>
        <div class="stats-grid">
          <div class="stat-card"><div class="stat-icon bg-primary"><i class="bi bi-collection"></i></div><div class="stat-info"><h3>6</h3><p>Toplam Proje</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-success"><i class="bi bi-people"></i></div><div class="stat-info"><h3>4</h3><p>Ekip Üyesi</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-warning"><i class="bi bi-megaphone"></i></div><div class="stat-info"><h3>5</h3><p>Aktif Duyuru</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-info"><i class="bi bi-envelope-open"></i></div><div class="stat-info"><h3>8</h3><p>Yeni Mesaj</p></div></div>
        </div>
        
        <!-- Grafikler -->
        <div class="charts-row" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:25px 0;">
          <div class="chart-box" style="background:white;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.08);">
            <h4 style="margin-bottom:15px;color:#333;"><i class="bi bi-pie-chart"></i> Hizmet Dağılımı</h4>
            <div style="height:250px;position:relative;"><canvas id="dashPieChart"></canvas></div>
          </div>
          <div class="chart-box" style="background:white;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.08);">
            <h4 style="margin-bottom:15px;color:#333;"><i class="bi bi-bar-chart"></i> Aylık Ziyaretçi</h4>
            <div style="height:250px;position:relative;"><canvas id="dashBarChart"></canvas></div>
          </div>
        </div>

        <!-- Ziyaretçi İstatistikleri -->
        <div class="visitor-stats" style="background:white;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.08);margin-bottom:25px;">
          <h4 style="margin-bottom:15px;color:#333;"><i class="bi bi-eye"></i> Site Ziyaretçi İstatistikleri</h4>
          <div style="display:flex;align-items:center;gap:15px;margin-bottom:20px;padding:15px;background:#f8f9fa;border-radius:8px;">
            <img src="https://visitor-badge.laobi.icu/badge?page_id=nuhregaibunsal.github.io" alt="Toplam Ziyaretçi" style="height:28px;">
            <span style="font-weight:600;color:#333;">Görüntülenme Sayası</span>
          </div>
          <div class="data-table">
            <table>
              <thead>
                <tr><th>Sayfa</th><th>Ziyaretçi</th><th>Trend</th><th>Son Güncelleme</th></tr>
              </thead>
              <tbody id="visitorTable">
                <tr><td><i class="bi bi-house"></i> Ana Sayfa</td><td><strong>1,247</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +12%</span></td><td>Bugün</td></tr>
                <tr><td><i class="bi bi-info-circle"></i> Hakkımızda</td><td><strong>523</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +8%</span></td><td>Bugün</td></tr>
                <tr><td><i class="bi bi-gear"></i> Hizmetler</td><td><strong>891</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +15%</span></td><td>Bugün</td></tr>
                <tr><td><i class="bi bi-collection"></i> Portföy</td><td><strong>412</strong></td><td><span style="color:#dc3545;"><i class="bi bi-arrow-down"></i> -3%</span></td><td>Bugün</td></tr>
                <tr><td><i class="bi bi-graph-up"></i> Sayılarla AgriNova</td><td><strong>287</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +22%</span></td><td>Bugün</td></tr>
                <tr><td><i class="bi bi-megaphone"></i> Duyurular</td><td><strong>156</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +5%</span></td><td>Bugün</td></tr>
                <tr><td><i class="bi bi-envelope"></i> İletişim</td><td><strong>634</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +18%</span></td><td>Bugün</td></tr>
              </tbody>
              <tfoot style="background:#f8f9fa;font-weight:600;">
                <tr><td>TOPLAM</td><td><strong>4,150</strong></td><td><span style="color:#28a745;"><i class="bi bi-arrow-up"></i> +11%</span></td><td>-</td></tr>
              </tfoot>
            </table>
          </div>
        </div>
        
        <div class="quick-actions">
          <h4>Hızlı İşlemler</h4>
          <div class="action-buttons">
            <button onclick="showSection('messages')" class="action-btn"><i class="bi bi-envelope-open"></i> Mesajlar</button>
            <button onclick="showSection('announcements')" class="action-btn"><i class="bi bi-megaphone"></i> Duyuru Ekle</button>
            <button onclick="showSection('subscribers')" class="action-btn"><i class="bi bi-envelope-at"></i> Aboneler</button>
          </div>
        </div>
      </section>

      <!-- Messages Section -->
      <section id="section-messages" class="content-section">
        <h2><i class="bi bi-envelope-open"></i> Gelen Mesajlar</h2>
        <div class="data-table">
          <table>
            <thead><tr><th>Tarih</th><th>Gönderen</th><th>E-posta</th><th>Konu</th><th>Durum</th><th>İşlemler</th></tr></thead>
            <tbody id="messagesTable"></tbody>
          </table>
        </div>
      </section>

      <!-- Applications Section -->
      <section id="section-applications" class="content-section">
        <h2><i class="bi bi-person-plus"></i> İş Başvuruları</h2>
        <div class="stats-grid" style="margin-bottom:20px;">
          <div class="stat-card"><div class="stat-icon bg-primary"><i class="bi bi-person-plus"></i></div><div class="stat-info"><h3>6</h3><p>Toplam Başvuru</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-warning"><i class="bi bi-hourglass-split"></i></div><div class="stat-info"><h3>3</h3><p>Beklemede</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-success"><i class="bi bi-check-circle"></i></div><div class="stat-info"><h3>2</h3><p>Görüşmeye Çağrıldı</p></div></div>
        </div>
        <div class="data-table">
          <table>
            <thead><tr><th>Tarih</th><th>Ad Soyad</th><th>E-posta</th><th>Pozisyon</th><th>Deneyim</th><th>Durum</th><th>İşlemler</th></tr></thead>
            <tbody id="applicationsTable"></tbody>
          </table>
        </div>
      </section>

      <!-- Subscribers Section -->
      <section id="section-subscribers" class="content-section">
        <h2><i class="bi bi-envelope-at"></i> Bülten Aboneleri</h2>
        <div class="stats-grid" style="margin-bottom:20px;">
          <div class="stat-card"><div class="stat-icon bg-success"><i class="bi bi-people"></i></div><div class="stat-info"><h3 id="totalSubscribers">12</h3><p>Toplam Abone</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-primary"><i class="bi bi-calendar-check"></i></div><div class="stat-info"><h3>5</h3><p>Bu Ay Yeni</p></div></div>
        </div>
        <div class="data-table">
          <table>
            <thead><tr><th>Tarih</th><th>E-posta Adresi</th><th>Durum</th><th>İşlemler</th></tr></thead>
            <tbody id="subscribersTable"></tbody>
          </table>
        </div>
      </section>

      <!-- Hero Section -->
      <section id="section-hero" class="content-section">
        <h2><i class="bi bi-house"></i> Hero Bölümü</h2>
        <div class="form-card">
          <div class="form-group"><label>Ana Başlık</label><input type="text" id="heroTitle" value="Geleceğin Tarımı Bugün Başlıyor"></div>
          <div class="form-group"><label>Alt Başlık (Slogan)</label><input type="text" id="heroSubtitle" value="Sürdürülebilir. Akıllı. Kârlı."></div>
          <div class="form-group"><label>Buton Metni</label><input type="text" id="heroButton" value="Hakkımızda"></div>
          <button class="btn-save" onclick="saveChanges('Hero Bölümü')"><i class="bi bi-check-lg"></i> Değişiklikleri Kaydet</button>
        </div>
      </section>

      <!-- Services Section -->
      <section id="section-services" class="content-section">
        <h2><i class="bi bi-gear"></i> Hizmetler</h2>
        <div class="data-table">
          <table>
            <thead><tr><th>İkon</th><th>Başlık</th><th>Açıklama</th><th>İşlemler</th></tr></thead>
            <tbody id="servicesTable">
            </tbody>
          </table>
        </div>
        <button class="btn-add" onclick="openAddModal('service')"><i class="bi bi-plus-lg"></i> Yeni Hizmet Ekle</button>
      </section>

      <!-- Portfolio Section -->
      <section id="section-portfolio" class="content-section">
        <h2><i class="bi bi-collection"></i> Projeler</h2>
        <div class="cards-grid" id="portfolioGrid"></div>
        <button class="btn-add" onclick="openAddModal('portfolio')"><i class="bi bi-plus-lg"></i> Yeni Proje Ekle</button>
      </section>

      <!-- Team Section -->
      <section id="section-team" class="content-section">
        <h2><i class="bi bi-people"></i> Ekip Üyeleri</h2>
        <div class="cards-grid" id="teamGrid"></div>
        <button class="btn-add" onclick="openAddModal('team')"><i class="bi bi-plus-lg"></i> Yeni Üye Ekle</button>
      </section>

      <!-- Pricing Section -->
      <section id="section-pricing" class="content-section">
        <h2><i class="bi bi-currency-dollar"></i> Fiyatlandırma Paketleri</h2>
        <div class="cards-grid" id="pricingGrid"></div>
      </section>

      <!-- FAQ Section -->
      <section id="section-faq" class="content-section">
        <h2><i class="bi bi-question-circle"></i> Sıkça Sorulan Sorular</h2>
        <div class="faq-list" id="faqList"></div>
        <button class="btn-add" onclick="openAddModal('faq')"><i class="bi bi-plus-lg"></i> Yeni Soru Ekle</button>
      </section>

      <!-- Announcements Section -->
      <section id="section-announcements" class="content-section">
        <h2><i class="bi bi-megaphone"></i> Duyurular</h2>
        <div class="data-table">
          <table>
            <thead><tr><th>Tarih</th><th>Başlık</th><th>Durum</th><th>İşlemler</th></tr></thead>
            <tbody id="announcementsTable"></tbody>
          </table>
        </div>
        <button class="btn-add" onclick="openAddModal('announcement')"><i class="bi bi-plus-lg"></i> Yeni Duyuru Ekle</button>
      </section>

      <!-- Testimonials Section -->
      <section id="section-testimonials" class="content-section">
        <h2><i class="bi bi-chat-quote"></i> Müşteri Yorumları</h2>
        <div class="cards-grid" id="testimonialsGrid"></div>
        <button class="btn-add" onclick="openAddModal('testimonial')"><i class="bi bi-plus-lg"></i> Yeni Yorum Ekle</button>
      </section>

      <!-- Contact Section -->
      <section id="section-contact" class="content-section">
        <h2><i class="bi bi-envelope"></i> İletişim Bilgileri</h2>
        <div class="form-card">
          <div class="form-group"><label>E-posta</label><input type="email" value="kurumsaliletisim@kocaeli.edu.tr"></div>
          <div class="form-group"><label>Telefon</label><input type="text" value="+90 (262) 303 10 43"></div>
          <div class="form-group"><label>Adres</label><textarea rows="2">Kabaoğlu, Baki Komsuoğlu Bulvarı No:515, Umuttepe, 41001 İzmit/Kocaeli</textarea></div>
          <button class="btn-save" onclick="saveChanges('İletişim Bilgileri')"><i class="bi bi-check-lg"></i> Değişiklikleri Kaydet</button>
        </div>
      </section>

      <!-- Users Section -->
      <section id="section-users" class="content-section">
        <h2><i class="bi bi-person-gear"></i> Kullanıcı Yönetimi</h2>
        
        <!-- User Stats -->
        <div class="stats-grid" style="margin-bottom:25px;">
          <div class="stat-card"><div class="stat-icon bg-primary"><i class="bi bi-people"></i></div><div class="stat-info"><h3 id="totalUsers">5</h3><p>Toplam Kullanıcı</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-success"><i class="bi bi-person-check"></i></div><div class="stat-info"><h3 id="activeUsers">4</h3><p>Aktif Kullanıcı</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-warning"><i class="bi bi-shield-check"></i></div><div class="stat-info"><h3 id="adminUsers">1</h3><p>Admin</p></div></div>
          <div class="stat-card"><div class="stat-icon bg-info"><i class="bi bi-pencil-square"></i></div><div class="stat-info"><h3 id="editorUsers">2</h3><p>Editör</p></div></div>
        </div>

        <!-- Add User Button -->
        <div style="margin-bottom:20px;">
          <button class="btn-save" onclick="openUserModal()" style="background:linear-gradient(135deg,#28a745,#20c997);"><i class="bi bi-person-plus"></i> Yeni Kullanıcı Ekle</button>
        </div>

        <!-- Users Table -->
        <div class="data-table">
          <table>
            <thead>
              <tr>
                <th>Kullanıcı Adı</th>
                <th>Ad Soyad</th>
                <th>E-posta</th>
                <th>Rol</th>
                <th>Son Giriş</th>
                <th>Durum</th>
                <th>İşlemler</th>
              </tr>
            </thead>
            <tbody id="usersTable"></tbody>
          </table>
        </div>

        <!-- Role Permissions Info -->
        <div style="margin-top:25px;background:white;border-radius:12px;padding:20px;box-shadow:0 2px 10px rgba(0,0,0,0.08);">
          <h4 style="margin-bottom:15px;color:#333;"><i class="bi bi-shield-lock"></i> Rol Yetkileri</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
            <div style="padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid #dc3545;">
              <strong style="color:#dc3545;"><i class="bi bi-shield-fill-check"></i> Admin</strong>
              <p style="font-size:0.85rem;color:#666;margin-top:5px;">Tüm yetkilere sahip. Kullanıcı yönetimi, sistem ayarları.</p>
            </div>
            <div style="padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid #0d6efd;">
              <strong style="color:#0d6efd;"><i class="bi bi-pencil-fill"></i> Editör</strong>
              <p style="font-size:0.85rem;color:#666;margin-top:5px;">İçerik ekleme, düzenleme ve silme yetkisi.</p>
            </div>
            <div style="padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid #ffc107;">
              <strong style="color:#856404;"><i class="bi bi-eye-fill"></i> Moderatör</strong>
              <p style="font-size:0.85rem;color:#666;margin-top:5px;">Yorumları ve mesajları yönetme yetkisi.</p>
            </div>
            <div style="padding:15px;background:#f8f9fa;border-radius:8px;border-left:4px solid #6c757d;">
              <strong style="color:#6c757d;"><i class="bi bi-person-fill"></i> İzleyici</strong>
              <p style="font-size:0.85rem;color:#666;margin-top:5px;">Sadece görüntüleme yetkisi.</p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Edit Modal -->
  <div class="modal-overlay" id="editModal">
    <div class="modal-content">
      <div class="modal-header"><h3 id="modalTitle">Düzenle</h3><button class="modal-close" onclick="closeModal()"><i class="bi bi-x-lg"></i></button></div>
      <div class="modal-body" id="modalBody"></div>
      <div class="modal-footer"><button class="btn-cancel" onclick="closeModal()">İptal</button><button class="btn-save" onclick="saveModalChanges()"><i class="bi bi-check-lg"></i> Kaydet</button></div>
    </div>
  </div>

  <!-- Delete Confirm Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal-content modal-sm">
      <div class="modal-header delete-header"><h3><i class="bi bi-exclamation-triangle"></i> Silme Onayı</h3><button class="modal-close" onclick="closeDeleteModal()"><i class="bi bi-x-lg"></i></button></div>
      <div class="modal-body"><p id="deleteMessage">Bu öğeyi silmek istediğinizden emin misiniz?</p><p class="text-muted small">Bu işlem geri alınamaz.</p></div>
      <div class="modal-footer"><button class="btn-cancel" onclick="closeDeleteModal()">İptal</button><button class="btn-delete-confirm" onclick="executeDelete()"><i class="bi bi-trash"></i> Sil</button></div>
    </div>
  </div>

  <!-- Application Detail Modal -->
  <div class="modal-overlay" id="applicationModal">
    <div class="modal-content" style="max-width:500px;">
      <div class="modal-header" style="background:linear-gradient(135deg,#28a745,#20c997);color:white;">
        <h3><i class="bi bi-person-badge"></i> Başvuru Detayı</h3>
        <button class="modal-close" onclick="closeApplicationModal()" style="color:white;"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom:15px;"><strong>Ad Soyad:</strong><p id="appDetailName" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>E-posta:</strong><p id="appDetailEmail" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Pozisyon:</strong><p id="appDetailPosition" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Deneyim:</strong><p id="appDetailExperience" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Başvuru Tarihi:</strong><p id="appDetailDate" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Durum:</strong><p id="appDetailStatus" style="margin:5px 0;"></p></div>
      </div>
      <div class="modal-footer" style="justify-content:flex-end;gap:10px;">
        <button class="btn-cancel" onclick="updateApplicationStatus('rejected')" style="background:#dc3545;color:white;border:none;"><i class="bi bi-x-circle"></i> Reddet</button>
        <button class="btn-cancel" onclick="updateApplicationStatus('interview')" style="background:#ffc107;color:#333;border:none;"><i class="bi bi-telephone"></i> Görüşmeye Çağır</button>
        <button class="btn-save" onclick="updateApplicationStatus('hired')" style="background:#28a745;"><i class="bi bi-check-circle"></i> Onayla</button>
      </div>
    </div>
  </div>

  <!-- Message Detail Modal -->
  <div class="modal-overlay" id="messageModal">
    <div class="modal-content" style="max-width:550px;">
      <div class="modal-header" style="background:linear-gradient(135deg,#0d6efd,#6610f2);color:white;">
        <h3><i class="bi bi-envelope-open"></i> Mesaj Detayı</h3>
        <button class="modal-close" onclick="closeMessageModal()" style="color:white;"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom:15px;"><strong>Gönderen:</strong><p id="msgDetailName" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>E-posta:</strong><p id="msgDetailEmail" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Konu:</strong><p id="msgDetailSubject" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Tarih:</strong><p id="msgDetailDate" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Mesaj:</strong><p id="msgDetailMessage" style="margin:5px 0;padding:15px;background:#f8f9fa;border-radius:8px;"></p></div>
        <div style="margin-bottom:15px;"><strong>Durum:</strong><span id="msgDetailStatus" style="margin-left:10px;"></span></div>
      </div>
      <div class="modal-footer" style="justify-content:flex-end;gap:10px;">
        <button class="btn-cancel" onclick="markMessageAsRead()" style="background:#6c757d;color:white;border:none;"><i class="bi bi-check2"></i> Okundu İşaretle</button>
        <button class="btn-save" onclick="openReplyModal()" style="background:#0d6efd;"><i class="bi bi-reply"></i> Cevapla</button>
      </div>
    </div>
  </div>

  <!-- Reply Modal -->
  <div class="modal-overlay" id="replyModal">
    <div class="modal-content" style="max-width:500px;">
      <div class="modal-header" style="background:linear-gradient(135deg,#0d6efd,#6610f2);color:white;">
        <h3><i class="bi bi-reply"></i> Mesajı Yanıtla</h3>
        <button class="modal-close" onclick="closeReplyModal()" style="color:white;"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom:15px;"><strong>Alıcı:</strong><p id="replyTo" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;"><strong>Konu:</strong><p id="replySubject" style="margin:5px 0;"></p></div>
        <div style="margin-bottom:15px;">
          <strong>Yanıtınız:</strong>
          <textarea id="replyMessage" rows="6" style="width:100%;margin-top:10px;padding:12px;border:1px solid #ddd;border-radius:8px;font-size:1rem;resize:vertical;" placeholder="Yanıtınızı buraya yazın..."></textarea>
        </div>
      </div>
      <div class="modal-footer" style="justify-content:flex-end;gap:10px;">
        <button class="btn-cancel" onclick="closeReplyModal()">İptal</button>
        <button class="btn-save" onclick="sendReply()" style="background:#0d6efd;"><i class="bi bi-send"></i> Gönder</button>
      </div>
    </div>
  </div>

  <!-- User Modal -->
  <div class="modal-overlay" id="userModal">
    <div class="modal-content" style="max-width:550px;">
      <div class="modal-header" style="background:linear-gradient(135deg,#6f42c1,#e83e8c);color:white;">
        <h3 id="userModalTitle"><i class="bi bi-person-plus"></i> Yeni Kullanıcı</h3>
        <button class="modal-close" onclick="closeUserModal()" style="color:white;"><i class="bi bi-x-lg"></i></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editUserId" value="">
        <div class="form-group" style="margin-bottom:15px;">
          <label style="display:block;margin-bottom:5px;font-weight:600;">Kullanıcı Adı *</label>
          <input type="text" id="userUsername" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;" placeholder="Kullanıcı adı girin">
        </div>
        <div class="form-group" style="margin-bottom:15px;">
          <label style="display:block;margin-bottom:5px;font-weight:600;">Ad Soyad *</label>
          <input type="text" id="userFullName" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;" placeholder="Ad soyad girin">
        </div>
        <div class="form-group" style="margin-bottom:15px;">
          <label style="display:block;margin-bottom:5px;font-weight:600;">E-posta *</label>
          <input type="email" id="userEmail" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;" placeholder="E-posta adresi girin">
        </div>
        <div class="form-group" style="margin-bottom:15px;">
          <label style="display:block;margin-bottom:5px;font-weight:600;">Şifre <span id="passwordHint" style="font-weight:normal;color:#666;">(yeni kullanıcı için zorunlu)</span></label>
          <input type="password" id="userPassword" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;" placeholder="Şifre girin">
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
          <div class="form-group">
            <label style="display:block;margin-bottom:5px;font-weight:600;">Rol *</label>
            <select id="userRole" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;">
              <option value="viewer">İzleyici</option>
              <option value="moderator">Moderatör</option>
              <option value="editor">Editör</option>
              <option value="admin">Admin</option>
            </select>
          </div>
          <div class="form-group">
            <label style="display:block;margin-bottom:5px;font-weight:600;">Durum *</label>
            <select id="userStatus" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;">
              <option value="active">Aktif</option>
              <option value="inactive">Pasif</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-footer" style="justify-content:flex-end;gap:10px;">
        <button class="btn-cancel" onclick="closeUserModal()">İptal</button>
        <button class="btn-save" onclick="saveUser()" style="background:linear-gradient(135deg,#6f42c1,#e83e8c);"><i class="bi bi-check-lg"></i> Kaydet</button>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
// ========== ADMIN PANEL JAVASCRIPT ==========

// Global veri depoları
var dataStore = {
  portfolio: [
    { id: 1, title: 'Mekândan Bağımsız Yüksek Verim', category: 'Dikey Tarım', client: 'Marmara Sera', img: 'assets/img/masonry-portfolio/dikey1.png', desc: 'Geleneksel tarıma göre %90 daha az su kullanarak yıl boyu üretim.' },
    { id: 2, title: 'Hassas Damla Sulama Yönetimi', category: 'Akıllı Sulama', client: 'Ege Tarım', img: 'assets/img/masonry-portfolio/sulama1.png', desc: 'Topraktan aldığımız anlık verilerle kaynak israfını önleriz.' },
    { id: 3, title: 'Tarladan Merkeze Anlık Veri Akışı', category: 'Veri Analizi', client: 'Trakya Çiftlikleri', img: 'assets/img/masonry-portfolio/veri1.png', desc: 'Milyonlarca veriyi güvenli şekilde aktararak süreçleri şeffaflaştırırız.' },
    { id: 4, title: 'Kontrollü İklim, Üstün Kalite', category: 'Dikey Tarım', client: 'İstanbul Yeşil Sera', img: 'assets/img/masonry-portfolio/dikey2.png', desc: 'Sıcaklık, nem ve LED spektrumlarını optimize ederek kaliteli ürünler.' },
    { id: 5, title: 'Toprak Nem ve Besin Sensörleri', category: 'Akıllı Sulama', client: 'Antalya Seracılık', img: 'assets/img/masonry-portfolio/sulama2.png', desc: 'Nem, pH ve sıcaklık seviyelerini sürekli takip eden sensörler.' },
    { id: 6, title: 'Gelişmiş Tarımsal Kontrol Panelleri', category: 'Veri Analizi', client: 'Konya Tarım', img: 'assets/img/masonry-portfolio/veri2.png', desc: 'Zorlu tarım koşullarında kesintisiz veri işleme performansı.' }
  ],
  team: [
    { id: 1, name: 'Dr. Ahmet Yılmaz', position: 'Ziraat Yüksek Mühendisi', img: 'assets/img/team/team-1.jpg' },
    { id: 2, name: 'Elif Kaya', position: 'Tarım Veri Bilimcisi', img: 'assets/img/team/team-2.jpg' },
    { id: 3, name: 'Mehmet Demir', position: 'IoT Donanım Geliştiricisi', img: 'assets/img/team/team-3.jpg' },
    { id: 4, name: 'Zeynep Arslan', position: 'Endüstriyel Otomasyon Uzmanı', img: 'assets/img/team/team-4.jpg' }
  ],
  pricing: [
    { id: 1, name: 'Temel Sulama', price: 19, features: 'Toprak Nem Sensörleri\nDamla Sulama Kontrolü\nMobil/Web Panel\nTemel Destek' },
    { id: 2, name: 'Dikey Otomasyon', price: 49, features: 'LED Spektrum Yönetimi\nBesin Dozajlama\nDikey Sistem Kontrolü\n7/24 Destek' },
    { id: 3, name: 'Veri ve Drone Analizi', price: 69, features: 'Gerçek Zamanlı Veri\nDrone Gözetimi\nAI Raporları\n7/24 Destek' },
    { id: 4, name: 'Tam Entegrasyon', price: 99, features: 'Tüm Özellikler\nÖncelikli Destek\nÖzel Hesap Yöneticisi' }
  ],
  faq: [
    { id: 1, q: 'Akıllı Tarım Sisteminiz Su Tüketimini Azaltır mı?', a: 'Evet. Dikey Tarım çözümlerimiz %90 daha az su kullanır.' },
    { id: 2, q: 'Sistem Kurulumu Ne Kadar Sürer?', a: 'Temel paketler 1-2 hafta, Tam Entegrasyon 4-6 hafta içinde tamamlanır.' },
    { id: 3, q: 'Dron Analizleri Hangi Verileri Toplar?', a: 'Bitki sağlığı (NDVI), nem stres seviyesi ve toprak haritalaması.' },
    { id: 4, q: 'Paketler Arası Geçiş Mümkün mü?', a: 'Evet, dilediğiniz zaman paket değişikliği yapabilirsiniz.' }
  ],
  announcements: [
    { id: 1, date: '03 Aralık 2024', title: 'Yeni Drone Analiz Hizmeti', content: 'Yeni nesil drone filosumuzu hizmete sunduk.', status: 'active' },
    { id: 2, date: '28 Kasım 2024', title: 'Kış Kampanyası Başladı', content: 'Tüm paketlerde %20 indirim!', status: 'active' },
    { id: 3, date: '15 Kasım 2024', title: 'IoT Sensör Güncellemesi', content: 'Firmware güncellemesi tamamlandı.', status: 'active' }
  ],
  testimonials: [
    { id: 1, name: 'Saul Goodman', position: 'Büyük Ölçekli Çiftlik Yöneticisi', comment: 'AgriNova ile çalışmak dönüm noktası oldu.', rating: 5, img: 'assets/img/testimonials/testimonials-1.jpg' },
    { id: 2, name: 'Sara Wilsson', position: 'Sürdürülebilirlik Araştırmacısı', comment: 'Çevre dostu yaklaşımları etkileyici.', rating: 4, img: 'assets/img/testimonials/testimonials-2.jpg' },
    { id: 3, name: 'Jena Karlis', position: 'Yatırım Fonu Yöneticisi', comment: 'Yatırım getirisi beklentilerin üzerinde.', rating: 5, img: 'assets/img/testimonials/testimonials-3.jpg' },
    { id: 4, name: 'Matt Brandon', position: 'Kentsel Tarım Girişimcisi', comment: 'Şehir içi projemizde büyük destek aldık.', rating: 4, img: 'assets/img/testimonials/testimonials-4.jpg' },
    { id: 5, name: 'John Larson', position: 'Ziraat Mühendisi', comment: 'Teknik ekipleri son derece profesyonel.', rating: 5, img: 'assets/img/testimonials/testimonials-5.jpg' }
  ],
  services: [
    { id: 1, title: 'Akıllı Sulama', icon: 'bi-droplet-half', desc: 'Sensör tabanlı gerçek zamanlı veri analizi ile bitki ihtiyaçlarına göre en ideal su miktarını otomatik olarak sağlar.' },
    { id: 2, title: 'Dikey Tarım Sistemleri', icon: 'bi-columns', desc: 'Şehir içi alanlarda, kapalı ve kontrollü ortamlarda, mevsimden bağımsız, yüksek verimli ürün yetiştirme çözümleri sunar.' },
    { id: 3, title: 'Verim Optimizasyonu', icon: 'bi-graph-up-arrow', desc: 'Makine öğrenimi algoritmaları sayesinde tohumdan hasada kadar tüm süreçleri izler.' },
    { id: 4, title: 'Sürdürülebilirlik Çözümleri', icon: 'bi-recycle', desc: 'Kimyasal kullanımını en aza indiren, enerji verimli ve çevre dostu uygulamalar.' }
  ],
  messages: [
    { id: 1, date: '03 Ara 2024', name: 'Mehmet Yıldız', email: 'mehmet@example.com', subject: 'Fiyat Teklifi', message: 'Tam Entegrasyon paketi için fiyat teklifi alabilir miyim?', status: 'unread' },
    { id: 2, date: '02 Ara 2024', name: 'Ayşe Kara', email: 'ayse@example.com', subject: 'Teknik Destek', message: 'Sensörlerimiz veri göndermiyor, yardımcı olur musunuz?', status: 'unread' },
    { id: 3, date: '01 Ara 2024', name: 'Ali Demir', email: 'ali@example.com', subject: 'Demo Talebi', message: 'Dikey tarım sistemi için demo görmek istiyoruz.', status: 'read' },
    { id: 4, date: '30 Kas 2024', name: 'Fatma Öz', email: 'fatma@example.com', subject: 'İş Birliği', message: 'Sera projemiz için iş birliği yapmak istiyoruz.', status: 'read' },
    { id: 5, date: '28 Kas 2024', name: 'Can Yılmaz', email: 'can@example.com', subject: 'Kurulum Süresi', message: 'Temel Sulama paketi kurulumu ne kadar sürer?', status: 'read' },
    { id: 6, date: '25 Kas 2024', name: 'Zeynep Ak', email: 'zeynep@example.com', subject: 'Garanti Bilgisi', message: 'Sensörlerin garanti süresi nedir?', status: 'replied' },
    { id: 7, date: '22 Kas 2024', name: 'Burak Şen', email: 'burak@example.com', subject: 'Eğitim Talebi', message: 'Personelimize sistem eğitimi verebilir misiniz?', status: 'replied' },
    { id: 8, date: '20 Kas 2024', name: 'Selin Koç', email: 'selin@example.com', subject: 'Referans Talebi', message: 'Mevcut müşterilerinizden referans alabilir miyiz?', status: 'replied' }
  ],
  subscribers: [
    { id: 1, date: '03 Ara 2024', email: 'ahmet.yilmaz@gmail.com', status: 'active' },
    { id: 2, date: '02 Ara 2024', email: 'elif.kaya@hotmail.com', status: 'active' },
    { id: 3, date: '01 Ara 2024', email: 'mehmet.demir@outlook.com', status: 'active' },
    { id: 4, date: '30 Kas 2024', email: 'zeynep.arslan@gmail.com', status: 'active' },
    { id: 5, date: '28 Kas 2024', email: 'can.ozturk@yahoo.com', status: 'active' },
    { id: 6, date: '25 Kas 2024', email: 'ayse.celik@gmail.com', status: 'active' },
    { id: 7, date: '22 Kas 2024', email: 'fatih.yildiz@hotmail.com', status: 'active' },
    { id: 8, date: '20 Kas 2024', email: 'seda.koc@outlook.com', status: 'active' },
    { id: 9, date: '18 Kas 2024', email: 'emre.sahin@gmail.com', status: 'active' },
    { id: 10, date: '15 Kas 2024', email: 'deniz.aydin@yahoo.com', status: 'unsubscribed' },
    { id: 11, date: '12 Kas 2024', email: 'berk.tas@gmail.com', status: 'active' },
    { id: 12, date: '10 Kas 2024', email: 'ece.yilmaz@hotmail.com', status: 'active' }
  ],
  applications: [
    { id: 1, date: '03 Ara 2024', name: 'Ahmet Yılmaz', email: 'ahmet.yilmaz@gmail.com', position: 'Ziraat Mühendisi', experience: '3-5', status: 'pending' },
    { id: 2, date: '02 Ara 2024', name: 'Elif Kaya', email: 'elif.kaya@hotmail.com', position: 'Veri Analisti', experience: '1-3', status: 'interview' },
    { id: 3, date: '01 Ara 2024', name: 'Mehmet Demir', email: 'mehmet.demir@outlook.com', position: 'IoT Uzmanı', experience: '3-5', status: 'pending' },
    { id: 4, date: '28 Kas 2024', name: 'Zeynep Arslan', email: 'zeynep.arslan@gmail.com', position: 'Yazılım Geliştirici', experience: '1-3', status: 'interview' },
    { id: 5, date: '25 Kas 2024', name: 'Can Öztürk', email: 'can.ozturk@yahoo.com', position: 'Satış Temsilcisi', experience: '0-1', status: 'pending' },
    { id: 6, date: '20 Kas 2024', name: 'Ayşe Çelik', email: 'ayse.celik@gmail.com', position: 'Ziraat Mühendisi', experience: '5+', status: 'rejected' }
  ],
  users: [
    { id: 1, username: 'Admin', email: 'admin@agrinova.com.tr', role: 'admin', fullName: 'Sistem Yöneticisi', lastLogin: '04 Ara 2024 23:15', status: 'active', createdAt: '01 Oca 2024' },
    { id: 2, username: 'editor1', email: 'editor@agrinova.com.tr', role: 'editor', fullName: 'Ahmet Editör', lastLogin: '03 Ara 2024 14:30', status: 'active', createdAt: '15 Mar 2024' },
    { id: 3, username: 'moderator1', email: 'moderator@agrinova.com.tr', role: 'moderator', fullName: 'Elif Moderatör', lastLogin: '02 Ara 2024 09:45', status: 'active', createdAt: '20 May 2024' },
    { id: 4, username: 'viewer1', email: 'viewer@agrinova.com.tr', role: 'viewer', fullName: 'Mehmet İzleyici', lastLogin: '28 Kas 2024 16:20', status: 'inactive', createdAt: '10 Haz 2024' },
    { id: 5, username: 'editor2', email: 'editor2@agrinova.com.tr', role: 'editor', fullName: 'Zeynep Editör', lastLogin: '01 Ara 2024 11:00', status: 'active', createdAt: '05 Tem 2024' }
  ]
};

var deleteTarget = { type: '', name: '' };
var currentEditType = '';
var currentEditId = null;

// Toast bildirimi
function showToast(title, message, type) {
  type = type || 'success';
  var container = document.getElementById('toastContainer');
  var icons = { success: 'check-circle-fill', error: 'x-circle-fill', warning: 'exclamation-triangle-fill', info: 'info-circle-fill' };
  var toast = document.createElement('div');
  toast.className = 'toast ' + type;
  toast.innerHTML = '<i class="bi bi-' + icons[type] + '"></i><div class="toast-content"><strong>' + title + '</strong><span>' + message + '</span></div><button class="toast-close" onclick="this.parentElement.remove()"><i class="bi bi-x"></i></button>';
  container.appendChild(toast);
  setTimeout(function() { if (toast.parentNode) toast.remove(); }, 3000);
}

// Çıkış
function logout() {
  sessionStorage.removeItem('isLoggedIn');
  sessionStorage.removeItem('adminUser');
  window.location.href = 'admin-login.html';
}

// Sidebar toggle
function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('open');
}

// Section göster
function showSection(sectionName) {
  var sections = document.querySelectorAll('.content-section');
  var navItems = document.querySelectorAll('.nav-item');
  for (var i = 0; i < sections.length; i++) sections[i].classList.remove('active');
  for (var j = 0; j < navItems.length; j++) navItems[j].classList.remove('active');
  document.getElementById('section-' + sectionName).classList.add('active');
  var nav = document.querySelector('[data-section="' + sectionName + '"]');
  if (nav) nav.classList.add('active');
}

// Kaydet
function saveChanges(section) {
  showToast('Başarılı!', section + ' bilgileri güncellendi.', 'success');
}

// Silme
function confirmDelete(type, name) {
  deleteTarget = { type: type, name: name };
  document.getElementById('deleteMessage').textContent = '"' + name + '" silinsin mi?';
  document.getElementById('deleteModal').classList.add('show');
}
function closeDeleteModal() { document.getElementById('deleteModal').classList.remove('show'); }
function executeDelete() {
  closeDeleteModal();
  showToast('Silindi!', deleteTarget.name + ' silindi.', 'error');
}

// Modal
function getDataById(type, id) {
  // service -> services, announcement -> announcements gibi çoğul isimleri kontrol et
  var key = type;
  if (type === 'service') key = 'services';
  else if (type === 'announcement') key = 'announcements';
  else if (type === 'testimonial') key = 'testimonials';
  
  var data = dataStore[key];
  if (!data) return null;
  for (var i = 0; i < data.length; i++) if (data[i].id === id) return data[i];
  return null;
}

function openEditModal(type, id) {
  currentEditType = type;
  currentEditId = id;
  var modal = document.getElementById('editModal');
  var title = document.getElementById('modalTitle');
  var body = document.getElementById('modalBody');
  var data = id ? getDataById(type, id) : null;
  var content = '';
  
  if (type === 'portfolio') {
    var p = data || { title: '', category: 'Dikey Tarım', client: '', desc: '', img: '' };
    title.textContent = id ? 'Proje Düzenle' : 'Yeni Proje';
    var imgPreview = p.img ? '<img src="' + p.img + '" id="portfolioImgPreview" style="max-width:100%;max-height:150px;border-radius:8px;object-fit:cover;">' : '<div id="portfolioImgPreview" style="width:100%;height:120px;background:#f0f0f0;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#999;"><i class="bi bi-image" style="font-size:2rem;"></i></div>';
    content = '<div class="form-group"><label>Proje Adı</label><input type="text" value="' + p.title + '"></div>' +
              '<div class="form-group"><label>Kategori</label><select><option' + (p.category==='Dikey Tarım'?' selected':'') + '>Dikey Tarım</option><option' + (p.category==='Akıllı Sulama'?' selected':'') + '>Akıllı Sulama</option><option' + (p.category==='Veri Analizi'?' selected':'') + '>Veri Analizi</option></select></div>' +
              '<div class="form-group"><label>Müşteri</label><input type="text" value="' + p.client + '"></div>' +
              '<div class="form-group"><label>Açıklama</label><textarea rows="3">' + (p.desc||'') + '</textarea></div>' +
              '<div class="form-group"><label>Proje Görseli</label>' +
              '<div style="margin-top:10px;position:relative;" id="imgContainer">' + imgPreview + 
              (p.img ? '<button type="button" onclick="removePortfolioImage()" style="position:absolute;top:5px;right:5px;background:#dc3545;color:white;border:none;border-radius:50%;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;"><i class="bi bi-trash"></i></button>' : '') +
              '</div>' +
              '<div style="margin-top:10px;display:flex;gap:10px;">' +
              '<input type="file" id="portfolioFileInput" accept="image/*" style="display:none;" onchange="previewPortfolioImage(this)">' +
              '<button type="button" onclick="document.getElementById(\'portfolioFileInput\').click()" style="padding:8px 16px;background:#28a745;color:white;border:none;border-radius:6px;cursor:pointer;display:flex;align-items:center;gap:5px;"><i class="bi bi-upload"></i> Görsel Ekle</button>' +
              '</div></div>';
  } else if (type === 'team') {
    var t = data || { name: '', position: '', img: '' };
    title.textContent = id ? 'Üye Düzenle' : 'Yeni Üye';
    content = '<div class="form-group"><label>Ad Soyad</label><input type="text" value="' + t.name + '"></div>' +
              '<div class="form-group"><label>Pozisyon</label><input type="text" value="' + t.position + '"></div>' +
              '<div class="form-group"><label>Fotoğraf URL</label><input type="text" value="' + t.img + '"></div>';
  } else if (type === 'pricing') {
    var pk = data || { name: '', price: 0, features: '' };
    title.textContent = id ? 'Paket Düzenle' : 'Yeni Paket';
    content = '<div class="form-group"><label>Paket Adı</label><input type="text" value="' + pk.name + '"></div>' +
              '<div class="form-group"><label>Fiyat ($)</label><input type="number" value="' + pk.price + '"></div>' +
              '<div class="form-group"><label>Özellikler</label><textarea rows="4">' + pk.features + '</textarea></div>';
  } else if (type === 'faq') {
    var f = data || { q: '', a: '' };
    title.textContent = id ? 'Soru Düzenle' : 'Yeni Soru';
    content = '<div class="form-group"><label>Soru</label><input type="text" value="' + f.q + '"></div>' +
              '<div class="form-group"><label>Cevap</label><textarea rows="3">' + f.a + '</textarea></div>';
  } else if (type === 'announcement') {
    var a = data || { title: '', content: '', status: 'active', attachment: '' };
    title.textContent = id ? 'Duyuru Düzenle' : 'Yeni Duyuru';
    var attachmentPreview = a.attachment ? '<div id="attachmentPreview" style="display:flex;align-items:center;gap:10px;padding:12px;background:#e8f5e9;border-radius:8px;margin-top:10px;"><i class="bi bi-file-earmark-check" style="font-size:1.5rem;color:#28a745;"></i><span style="flex:1;">' + a.attachment + '</span><button type="button" onclick="removeAttachment()" style="background:#dc3545;color:white;border:none;border-radius:4px;padding:5px 10px;cursor:pointer;"><i class="bi bi-x"></i></button></div>' : '<div id="attachmentPreview"></div>';
    content = '<div class="form-group"><label>Başlık</label><input type="text" id="announcementTitle" value="' + a.title + '"></div>' +
              '<div class="form-group"><label>İçerik</label><textarea rows="4" id="announcementContent">' + (a.content||'') + '</textarea></div>' +
              '<div class="form-group"><label>Ek Dosya (PDF, Görsel vb.)</label>' +
              '<input type="file" id="announcementFile" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif" style="display:none;" onchange="previewAttachment(this)">' +
              '<div style="margin-top:10px;">' +
              '<button type="button" onclick="document.getElementById(\'announcementFile\').click()" style="padding:10px 20px;background:linear-gradient(135deg,#6c757d,#495057);color:white;border:none;border-radius:8px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all 0.3s;"><i class="bi bi-paperclip"></i> Dosya Ekle</button>' +
              '<span style="margin-left:10px;font-size:0.85rem;color:#6c757d;">Maks. 5MB (PDF, DOC, JPG, PNG)</span>' +
              '</div>' + attachmentPreview + '</div>' +
              '<div class="form-group"><label>Durum</label><select id="announcementStatus"><option value="active"' + (a.status==='active'?' selected':'') + '>Aktif</option><option value="inactive"' + (a.status==='inactive'?' selected':'') + '>Pasif</option></select></div>';
  } else if (type === 'testimonial') {
    var ts = data || { name: '', position: '', comment: '', rating: 5 };
    title.textContent = id ? 'Yorum Düzenle' : 'Yeni Yorum';
    content = '<div class="form-group"><label>Müşteri Adı</label><input type="text" value="' + ts.name + '"></div>' +
              '<div class="form-group"><label>Pozisyon</label><input type="text" value="' + ts.position + '"></div>' +
              '<div class="form-group"><label>Yorum</label><textarea rows="3">' + (ts.comment||'') + '</textarea></div>' +
              '<div class="form-group"><label>Puan (1-5)</label><input type="number" min="1" max="5" value="' + ts.rating + '"></div>';
  } else if (type === 'service') {
    var svc = data || { title: '', icon: 'bi-gear', desc: '' };
    title.textContent = id ? 'Hizmet Düzenle' : 'Yeni Hizmet';
    content = '<div class="form-group"><label>Başlık</label><input type="text" value="' + svc.title + '"></div>' +
              '<div class="form-group"><label>İkon (Bootstrap Icons - örn: bi-droplet-half)</label><input type="text" value="' + svc.icon + '"></div>' +
              '<div class="form-group"><label>Açıklama</label><textarea rows="3">' + svc.desc + '</textarea></div>';
  }
  body.innerHTML = content;
  modal.classList.add('show');
}

function openAddModal(type) { openEditModal(type, null); }
function closeModal() { document.getElementById('editModal').classList.remove('show'); }
function saveModalChanges() {
  closeModal();
  showToast(currentEditId ? 'Güncellendi!' : 'Eklendi!', 'Kayıt başarıyla ' + (currentEditId ? 'güncellendi.' : 'oluşturuldu.'), currentEditId ? 'success' : 'info');
}

// Portfolio resim önizleme
function previewPortfolioImage(input) {
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    reader.onload = function(e) {
      var container = document.getElementById('imgContainer');
      container.innerHTML = '<img src="' + e.target.result + '" id="portfolioImgPreview" style="max-width:100%;max-height:150px;border-radius:8px;object-fit:cover;">' +
                           '<button type="button" onclick="removePortfolioImage()" style="position:absolute;top:5px;right:5px;background:#dc3545;color:white;border:none;border-radius:50%;width:28px;height:28px;cursor:pointer;display:flex;align-items:center;justify-content:center;"><i class="bi bi-trash"></i></button>';
      showToast('Görsel Eklendi', 'Görsel başarıyla yüklendi.', 'success');
    };
    reader.readAsDataURL(input.files[0]);
  }
}

// Portfolio resim silme
function removePortfolioImage() {
  var container = document.getElementById('imgContainer');
  container.innerHTML = '<div id="portfolioImgPreview" style="width:100%;height:120px;background:#f0f0f0;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#999;"><i class="bi bi-image" style="font-size:2rem;"></i></div>';
  var fileInput = document.getElementById('portfolioFileInput');
  if (fileInput) fileInput.value = '';
  showToast('Görsel Silindi', 'Görsel başarıyla kaldırıldı.', 'info');
}

// Duyuru dosya önizleme
function previewAttachment(input) {
  if (input.files && input.files[0]) {
    var file = input.files[0];
    var maxSize = 5 * 1024 * 1024;
    if (file.size > maxSize) {
      showToast('Hata', 'Dosya boyutu 5MB\'dan büyük olamaz.', 'error');
      input.value = '';
      return;
    }
    var allowedTypes = ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'image/jpeg', 'image/png', 'image/gif'];
    if (allowedTypes.indexOf(file.type) === -1) {
      showToast('Hata', 'Geçersiz dosya türü.', 'error');
      input.value = '';
      return;
    }
    var fileIcon = 'bi-file-earmark';
    if (file.type === 'application/pdf') fileIcon = 'bi-file-earmark-pdf';
    else if (file.type.indexOf('image') !== -1) fileIcon = 'bi-file-earmark-image';
    else if (file.type.indexOf('word') !== -1) fileIcon = 'bi-file-earmark-word';
    var fileSize = (file.size / 1024).toFixed(1) + ' KB';
    if (file.size > 1024 * 1024) fileSize = (file.size / (1024 * 1024)).toFixed(2) + ' MB';
    var preview = document.getElementById('attachmentPreview');
    preview.innerHTML = '<div style="display:flex;align-items:center;gap:10px;padding:12px;background:#e8f5e9;border-radius:8px;margin-top:10px;">' +
      '<i class="bi ' + fileIcon + '" style="font-size:1.5rem;color:#28a745;"></i>' +
      '<div style="flex:1;"><strong style="display:block;">' + file.name + '</strong><span style="font-size:0.8rem;color:#6c757d;">' + fileSize + '</span></div>' +
      '<button type="button" onclick="removeAttachment()" style="background:#dc3545;color:white;border:none;border-radius:4px;padding:5px 10px;cursor:pointer;"><i class="bi bi-x"></i></button>' +
      '</div>';
    showToast('Dosya Eklendi', file.name + ' başarıyla yüklendi.', 'success');
  }
}

// Duyuru dosya silme
function removeAttachment() {
  var preview = document.getElementById('attachmentPreview');
  if (preview) preview.innerHTML = '';
  var fileInput = document.getElementById('announcementFile');
  if (fileInput) fileInput.value = '';
  showToast('Dosya Kaldırıldı', 'Ek dosya başarıyla silindi.', 'info');
}

// Veri yükleme
function loadAllData() {
  loadServices(); loadPortfolio(); loadTeam(); loadPricing(); loadFAQ(); loadAnnouncements(); loadTestimonials(); loadMessages(); loadSubscribers(); loadApplications(); loadUsers(); initCharts();
}

function loadApplications() {
  var html = '';
  var statusLabels = { pending: 'Beklemede', interview: 'Görüşmeye Çağrıldı', rejected: 'Reddedildi', hired: 'İşe Alındı' };
  var statusColors = { pending: 'warning', interview: 'success', rejected: 'secondary', hired: 'primary' };
  for (var i = 0; i < dataStore.applications.length; i++) {
    var a = dataStore.applications[i];
    html += '<tr><td>' + a.date + '</td><td>' + a.name + '</td><td>' + a.email + '</td><td>' + a.position + '</td><td>' + a.experience + ' Yıl</td><td><span class="status-badge status-' + statusColors[a.status] + '">' + statusLabels[a.status] + '</span></td><td><button class="btn-edit" onclick="viewApplication(' + a.id + ')"><i class="bi bi-eye"></i></button><button class="btn-delete" onclick="confirmDelete(\'Başvuru\',\'' + a.name + '\')"><i class="bi bi-trash"></i></button></td></tr>';
  }
  document.getElementById('applicationsTable').innerHTML = html;
}

var currentApplicationId = null;

function viewApplication(id) {
  var a = null;
  for (var i = 0; i < dataStore.applications.length; i++) {
    if (dataStore.applications[i].id === id) { a = dataStore.applications[i]; break; }
  }
  if (a) {
    currentApplicationId = id;
    var statusLabels = { pending: 'Beklemede', interview: 'Görüşmeye Çağrıldı', rejected: 'Reddedildi', hired: 'İşe Alındı' };
    document.getElementById('appDetailName').textContent = a.name;
    document.getElementById('appDetailEmail').textContent = a.email;
    document.getElementById('appDetailPosition').textContent = a.position;
    document.getElementById('appDetailExperience').textContent = a.experience + ' Yıl';
    document.getElementById('appDetailDate').textContent = a.date;
    document.getElementById('appDetailStatus').textContent = statusLabels[a.status] || a.status;
    document.getElementById('applicationModal').classList.add('show');
  }
}

function closeApplicationModal() {
  document.getElementById('applicationModal').classList.remove('show');
  currentApplicationId = null;
}

function updateApplicationStatus(newStatus) {
  if (currentApplicationId === null) return;
  for (var i = 0; i < dataStore.applications.length; i++) {
    if (dataStore.applications[i].id === currentApplicationId) {
      dataStore.applications[i].status = newStatus;
      break;
    }
  }
  var statusMessages = { rejected: 'Başvuru reddedildi.', interview: 'Aday görüşmeye çağrıldı.', hired: 'Aday işe alındı!' };
  var statusTypes = { rejected: 'error', interview: 'warning', hired: 'success' };
  closeApplicationModal();
  loadApplications();
  showToast('Durum Güncellendi', statusMessages[newStatus], statusTypes[newStatus]);
}

function loadMessages() {
  var html = '';
  var statusLabels = { unread: 'Okunmadı', read: 'Okundu', replied: 'Yanıtlandı' };
  var statusColors = { unread: 'warning', read: 'secondary', replied: 'success' };
  for (var i = 0; i < dataStore.messages.length; i++) {
    var m = dataStore.messages[i];
    html += '<tr><td>' + m.date + '</td><td>' + m.name + '</td><td>' + m.email + '</td><td>' + m.subject + '</td><td><span class="status-badge status-' + statusColors[m.status] + '">' + statusLabels[m.status] + '</span></td><td><button class="btn-edit" onclick="viewMessage(' + m.id + ')"><i class="bi bi-eye"></i></button><button class="btn-delete" onclick="confirmDelete(\'Mesaj\',\'' + m.subject + '\')"><i class="bi bi-trash"></i></button></td></tr>';
  }
  document.getElementById('messagesTable').innerHTML = html;
}

function loadSubscribers() {
  var html = '';
  for (var i = 0; i < dataStore.subscribers.length; i++) {
    var s = dataStore.subscribers[i];
    var statusLabel = s.status === 'active' ? 'Aktif' : 'Ayrıldı';
    var statusColor = s.status === 'active' ? 'success' : 'secondary';
    html += '<tr><td>' + s.date + '</td><td>' + s.email + '</td><td><span class="status-badge status-' + statusColor + '">' + statusLabel + '</span></td><td><button class="btn-delete" onclick="confirmDelete(\'Abone\',\'' + s.email + '\')"><i class="bi bi-trash"></i></button></td></tr>';
  }
  document.getElementById('subscribersTable').innerHTML = html;
}

var currentMessageId = null;

function viewMessage(id) {
  var m = null;
  for (var i = 0; i < dataStore.messages.length; i++) {
    if (dataStore.messages[i].id === id) { m = dataStore.messages[i]; break; }
  }
  if (m) {
    currentMessageId = id;
    var statusLabels = { unread: 'Okunmadı', read: 'Okundu', replied: 'Yanıtlandı' };
    var statusColors = { unread: 'warning', read: 'secondary', replied: 'success' };
    document.getElementById('msgDetailName').textContent = m.name;
    document.getElementById('msgDetailEmail').textContent = m.email;
    document.getElementById('msgDetailSubject').textContent = m.subject;
    document.getElementById('msgDetailDate').textContent = m.date;
    document.getElementById('msgDetailMessage').textContent = m.message;
    document.getElementById('msgDetailStatus').innerHTML = '<span class="status-badge status-' + statusColors[m.status] + '">' + statusLabels[m.status] + '</span>';
    document.getElementById('messageModal').classList.add('show');
  }
}

function closeMessageModal() {
  document.getElementById('messageModal').classList.remove('show');
}

function markMessageAsRead() {
  if (currentMessageId === null) return;
  for (var i = 0; i < dataStore.messages.length; i++) {
    if (dataStore.messages[i].id === currentMessageId) {
      dataStore.messages[i].status = 'read';
      break;
    }
  }
  closeMessageModal();
  loadMessages();
  showToast('Durum Güncellendi', 'Mesaj okundu olarak işaretlendi.', 'info');
}

function openReplyModal() {
  var m = null;
  for (var i = 0; i < dataStore.messages.length; i++) {
    if (dataStore.messages[i].id === currentMessageId) { m = dataStore.messages[i]; break; }
  }
  if (m) {
    document.getElementById('replyTo').textContent = m.name + ' <' + m.email + '>';
    document.getElementById('replySubject').textContent = 'RE: ' + m.subject;
    document.getElementById('replyMessage').value = '';
    document.getElementById('replyModal').classList.add('show');
  }
}

function closeReplyModal() {
  document.getElementById('replyModal').classList.remove('show');
}

function sendReply() {
  var replyText = document.getElementById('replyMessage').value.trim();
  if (!replyText) {
    showToast('Hata', 'Lütfen bir yanıt yazın.', 'error');
    return;
  }
  
  // Mesaj durumunu güncelle
  for (var i = 0; i < dataStore.messages.length; i++) {
    if (dataStore.messages[i].id === currentMessageId) {
      dataStore.messages[i].status = 'replied';
      break;
    }
  }
  
  closeReplyModal();
  closeMessageModal();
  loadMessages();
  showToast('Yanıt Gönderildi', 'Mesajınız başarıyla gönderildi.', 'success');
  currentMessageId = null;
}

function initCharts() {
  // Pasta Grafik
  var pieCtx = document.getElementById('dashPieChart');
  if (pieCtx) {
    new Chart(pieCtx, {
      type: 'doughnut',
      data: {
        labels: ['Akıllı Sulama', 'Dikey Tarım', 'Drone Analiz', 'Veri Platformu'],
        datasets: [{
          data: [35, 28, 22, 15],
          backgroundColor: ['#28a745', '#20c997', '#17a2b8', '#6f42c1'],
          borderWidth: 2,
          borderColor: '#fff'
        }]
      },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });
  }
  
  // Çubuk Grafik
  var barCtx = document.getElementById('dashBarChart');
  if (barCtx) {
    new Chart(barCtx, {
      type: 'bar',
      data: {
        labels: ['Oca', 'Şub', 'Mar', 'Nis', 'May', 'Haz'],
        datasets: [{
          label: 'Ziyaretçi',
          data: [1200, 1900, 2400, 2100, 2800, 3200],
          backgroundColor: '#28a745',
          borderRadius: 6
        }]
      },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
    });
  }
}

function loadServices() {
  var html = '';
  for (var i = 0; i < dataStore.services.length; i++) {
    var s = dataStore.services[i];
    html += '<tr><td><i class="bi ' + s.icon + '"></i></td><td>' + s.title + '</td><td>' + s.desc.substring(0,50) + '...</td><td><button class="btn-edit" onclick="openEditModal(\'service\',' + s.id + ')"><i class="bi bi-pencil"></i></button><button class="btn-delete" onclick="confirmDelete(\'Hizmet\',\'' + s.title + '\')"><i class="bi bi-trash"></i></button></td></tr>';
  }
  document.getElementById('servicesTable').innerHTML = html;
}

function loadPortfolio() {
  var html = '';
  for (var i = 0; i < dataStore.portfolio.length; i++) {
    var p = dataStore.portfolio[i];
    html += '<div class="admin-card"><img src="' + p.img + '" alt=""><div class="admin-card-body"><h4>' + p.title + '</h4><p class="card-meta">' + p.category + ' | ' + p.client + '</p><div class="admin-card-actions"><button class="btn-edit" onclick="openEditModal(\'portfolio\',' + p.id + ')"><i class="bi bi-pencil"></i> Düzenle</button><button class="btn-delete" onclick="confirmDelete(\'Proje\',\'' + p.title + '\')"><i class="bi bi-trash"></i></button></div></div></div>';
  }
  document.getElementById('portfolioGrid').innerHTML = html;
}

function loadTeam() {
  var html = '';
  for (var i = 0; i < dataStore.team.length; i++) {
    var t = dataStore.team[i];
    html += '<div class="admin-card"><img src="' + t.img + '" alt=""><div class="admin-card-body"><h4>' + t.name + '</h4><p>' + t.position + '</p><div class="admin-card-actions"><button class="btn-edit" onclick="openEditModal(\'team\',' + t.id + ')"><i class="bi bi-pencil"></i> Düzenle</button><button class="btn-delete" onclick="confirmDelete(\'Üye\',\'' + t.name + '\')"><i class="bi bi-trash"></i></button></div></div></div>';
  }
  document.getElementById('teamGrid').innerHTML = html;
}

function loadPricing() {
  var html = '';
  for (var i = 0; i < dataStore.pricing.length; i++) {
    var p = dataStore.pricing[i];
    var feat = p.features.split('\n').map(function(f){return '<li>'+f+'</li>';}).join('');
    html += '<div class="admin-card"><div class="admin-card-body"><h4>' + p.name + '</h4><p style="font-size:1.5rem;color:#28a745;font-weight:700;">$' + p.price + '/ay</p><ul style="font-size:0.85rem;color:#6c757d;">' + feat + '</ul><div class="admin-card-actions"><button class="btn-edit" onclick="openEditModal(\'pricing\',' + p.id + ')"><i class="bi bi-pencil"></i> Düzenle</button></div></div></div>';
  }
  document.getElementById('pricingGrid').innerHTML = html;
}

function loadFAQ() {
  var html = '';
  for (var i = 0; i < dataStore.faq.length; i++) {
    var f = dataStore.faq[i];
    html += '<div class="faq-item"><h4><i class="bi bi-question-circle"></i> ' + f.q + '</h4><p>' + f.a + '</p><div class="faq-actions"><button class="btn-edit" onclick="openEditModal(\'faq\',' + f.id + ')"><i class="bi bi-pencil"></i> Düzenle</button><button class="btn-delete" onclick="confirmDelete(\'Soru\',\'' + f.q.substring(0,20) + '...\')"><i class="bi bi-trash"></i></button></div></div>';
  }
  document.getElementById('faqList').innerHTML = html;
}

function loadAnnouncements() {
  var html = '';
  for (var i = 0; i < dataStore.announcements.length; i++) {
    var a = dataStore.announcements[i];
    html += '<tr><td>' + a.date + '</td><td>' + a.title + '</td><td><span class="status-badge status-' + a.status + '">' + (a.status==='active'?'Aktif':'Pasif') + '</span></td><td><button class="btn-edit" onclick="openEditModal(\'announcement\',' + a.id + ')"><i class="bi bi-pencil"></i></button><button class="btn-delete" onclick="confirmDelete(\'Duyuru\',\'' + a.title + '\')"><i class="bi bi-trash"></i></button></td></tr>';
  }
  document.getElementById('announcementsTable').innerHTML = html;
}

function loadTestimonials() {
  var html = '';
  for (var i = 0; i < dataStore.testimonials.length; i++) {
    var t = dataStore.testimonials[i];
    var stars = '';
    for (var j = 0; j < 5; j++) stars += j < t.rating ? '★' : '☆';
    html += '<div class="admin-card"><img src="' + t.img + '" alt="" style="height:120px;object-fit:cover;"><div class="admin-card-body"><h4>' + t.name + '</h4><p class="card-meta">' + t.position + '</p><p>' + stars + '</p><div class="admin-card-actions"><button class="btn-edit" onclick="openEditModal(\'testimonial\',' + t.id + ')"><i class="bi bi-pencil"></i> Düzenle</button><button class="btn-delete" onclick="confirmDelete(\'Yorum\',\'' + t.name + '\')"><i class="bi bi-trash"></i></button></div></div></div>';
  }
  document.getElementById('testimonialsGrid').innerHTML = html;
}

// ========== KULLANICI YÖNETİMİ ==========
var currentUserId = null;

function loadUsers() {
  var html = '';
  var roleLabels = { admin: 'Admin', editor: 'Editör', moderator: 'Moderatör', viewer: 'İzleyici' };
  var roleColors = { admin: '#dc3545', editor: '#0d6efd', moderator: '#ffc107', viewer: '#6c757d' };
  
  for (var i = 0; i < dataStore.users.length; i++) {
    var u = dataStore.users[i];
    var statusBadge = u.status === 'active' 
      ? '<span class="status-badge status-active">Aktif</span>' 
      : '<span class="status-badge status-inactive">Pasif</span>';
    var roleBadge = '<span style="background:' + roleColors[u.role] + ';color:white;padding:3px 10px;border-radius:12px;font-size:0.75rem;">' + roleLabels[u.role] + '</span>';
    
    var isCurrentAdmin = u.username === 'Admin';
    var deleteBtn = isCurrentAdmin 
      ? '<button class="btn-delete" disabled style="opacity:0.5;cursor:not-allowed;" title="Ana admin silinemez"><i class="bi bi-trash"></i></button>'
      : '<button class="btn-delete" onclick="confirmDeleteUser(' + u.id + ',\'' + u.username + '\')"><i class="bi bi-trash"></i></button>';
    
    html += '<tr>' +
      '<td><strong>' + u.username + '</strong></td>' +
      '<td>' + u.fullName + '</td>' +
      '<td>' + u.email + '</td>' +
      '<td>' + roleBadge + '</td>' +
      '<td><small>' + u.lastLogin + '</small></td>' +
      '<td>' + statusBadge + '</td>' +
      '<td>' +
        '<button class="btn-edit" onclick="openUserModal(' + u.id + ')"><i class="bi bi-pencil"></i></button>' +
        deleteBtn +
      '</td>' +
    '</tr>';
  }
  document.getElementById('usersTable').innerHTML = html;
  
  // İstatistikleri güncelle
  updateUserStats();
}

function updateUserStats() {
  var total = dataStore.users.length;
  var active = dataStore.users.filter(function(u) { return u.status === 'active'; }).length;
  var admins = dataStore.users.filter(function(u) { return u.role === 'admin'; }).length;
  var editors = dataStore.users.filter(function(u) { return u.role === 'editor'; }).length;
  
  document.getElementById('totalUsers').textContent = total;
  document.getElementById('activeUsers').textContent = active;
  document.getElementById('adminUsers').textContent = admins;
  document.getElementById('editorUsers').textContent = editors;
}

function openUserModal(userId) {
  currentUserId = userId || null;
  var modal = document.getElementById('userModal');
  var title = document.getElementById('userModalTitle');
  
  // Form alanlarını temizle
  document.getElementById('editUserId').value = '';
  document.getElementById('userUsername').value = '';
  document.getElementById('userFullName').value = '';
  document.getElementById('userEmail').value = '';
  document.getElementById('userPassword').value = '';
  document.getElementById('userRole').value = 'viewer';
  document.getElementById('userStatus').value = 'active';
  
  if (userId) {
    // Düzenleme modu
    title.innerHTML = '<i class="bi bi-person-gear"></i> Kullanıcı Düzenle';
    document.getElementById('passwordHint').textContent = '(boş bırakılırsa değişmez)';
    
    var user = null;
    for (var i = 0; i < dataStore.users.length; i++) {
      if (dataStore.users[i].id === userId) {
        user = dataStore.users[i];
        break;
      }
    }
    
    if (user) {
      document.getElementById('editUserId').value = user.id;
      document.getElementById('userUsername').value = user.username;
      document.getElementById('userFullName').value = user.fullName;
      document.getElementById('userEmail').value = user.email;
      document.getElementById('userRole').value = user.role;
      document.getElementById('userStatus').value = user.status;
    }
  } else {
    // Yeni kullanıcı modu
    title.innerHTML = '<i class="bi bi-person-plus"></i> Yeni Kullanıcı';
    document.getElementById('passwordHint').textContent = '(yeni kullanıcı için zorunlu)';
  }
  
  modal.classList.add('show');
}

function closeUserModal() {
  document.getElementById('userModal').classList.remove('show');
  currentUserId = null;
}

function saveUser() {
  var userId = document.getElementById('editUserId').value;
  var username = document.getElementById('userUsername').value.trim();
  var fullName = document.getElementById('userFullName').value.trim();
  var email = document.getElementById('userEmail').value.trim();
  var password = document.getElementById('userPassword').value;
  var role = document.getElementById('userRole').value;
  var status = document.getElementById('userStatus').value;
  
  // Validasyon
  if (!username || !fullName || !email) {
    showToast('Hata', 'Lütfen zorunlu alanları doldurun.', 'error');
    return;
  }
  
  // E-posta formatı kontrolü
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    showToast('Hata', 'Geçerli bir e-posta adresi girin.', 'error');
    return;
  }
  
  // Yeni kullanıcı için şifre zorunlu
  if (!userId && !password) {
    showToast('Hata', 'Yeni kullanıcı için şifre zorunludur.', 'error');
    return;
  }
  
  // Kullanıcı adı benzersizlik kontrolü
  for (var i = 0; i < dataStore.users.length; i++) {
    if (dataStore.users[i].username.toLowerCase() === username.toLowerCase() && 
        dataStore.users[i].id !== parseInt(userId)) {
      showToast('Hata', 'Bu kullanıcı adı zaten kullanılıyor.', 'error');
      return;
    }
  }
  
  if (userId) {
    // Güncelleme
    for (var j = 0; j < dataStore.users.length; j++) {
      if (dataStore.users[j].id === parseInt(userId)) {
        dataStore.users[j].username = username;
        dataStore.users[j].fullName = fullName;
        dataStore.users[j].email = email;
        dataStore.users[j].role = role;
        dataStore.users[j].status = status;
        break;
      }
    }
    showToast('Başarılı', 'Kullanıcı bilgileri güncellendi.', 'success');
  } else {
    // Yeni kullanıcı
    var newId = Math.max.apply(null, dataStore.users.map(function(u) { return u.id; })) + 1;
    var now = new Date();
    var dateStr = ('0' + now.getDate()).slice(-2) + ' ' + 
                  ['Oca','Şub','Mar','Nis','May','Haz','Tem','Ağu','Eyl','Eki','Kas','Ara'][now.getMonth()] + ' ' + 
                  now.getFullYear();
    
    dataStore.users.push({
      id: newId,
      username: username,
      email: email,
      role: role,
      fullName: fullName,
      lastLogin: 'Henüz giriş yapmadı',
      status: status,
      createdAt: dateStr
    });
    showToast('Başarılı', 'Yeni kullanıcı eklendi.', 'success');
  }
  
  closeUserModal();
  loadUsers();
}

function confirmDeleteUser(userId, username) {
  if (username === 'Admin') {
    showToast('Hata', 'Ana admin kullanıcısı silinemez!', 'error');
    return;
  }
  
  currentUserId = userId;
  document.getElementById('deleteMessage').textContent = '"' + username + '" kullanıcısını silmek istediğinizden emin misiniz?';
  document.getElementById('deleteModal').classList.add('show');
  
  // Delete butonuna özel işlev ata
  var deleteBtn = document.querySelector('.btn-delete-confirm');
  deleteBtn.onclick = function() {
    executeDeleteUser();
  };
}

function executeDeleteUser() {
  if (!currentUserId) return;
  
  dataStore.users = dataStore.users.filter(function(u) { return u.id !== currentUserId; });
  
  document.getElementById('deleteModal').classList.remove('show');
  loadUsers();
  showToast('Silindi', 'Kullanıcı başarıyla silindi.', 'error');
  currentUserId = null;
}

// Sayfa yüklendiğinde
document.addEventListener('DOMContentLoaded', function() {
  // Oturum kontrolü
  if (sessionStorage.getItem('isLoggedIn') !== 'true') {
    window.location.href = 'admin-login.html';
    return;
  }
  document.getElementById('adminName').textContent = sessionStorage.getItem('adminUser') || 'Admin';
  
  // Navigation
  var navItems = document.querySelectorAll('.nav-item');
  for (var i = 0; i < navItems.length; i++) {
    navItems[i].onclick = function(e) {
      e.preventDefault();
      showSection(this.getAttribute('data-section'));
    };
  }
  
  // Verileri yükle
  loadAllData();
  
  // Hoş geldin mesajı
  setTimeout(function() {
    showToast('Hoş Geldiniz!', 'Admin paneline giriş yaptınız.', 'success');
  }, 500);
});
</script>
</body>
</html>
